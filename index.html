<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.css">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
    <link rel="stylesheet" type="text/css"
        href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <title>Royal Caribbean Cruise Ltd</title>
</head>

<body>
    <form class="needs-validation" id="guestRegistrationForm" onsubmit="registerGuest()" novalidate>
        <div class="text-center pt-2" style="width: 450px; margin: 0 auto;">
            <div class="pt-2">
                <h4>Royal Caribbean Cruise Ltd</h4>
            </div>
            <div class="pb-2">
                <p>Guest Registration</p>
            </div>
            <div class="card text-center">
                <div class="card-header">
                    Guest Information
                </div>
                <div class="card-body">
                    <div class="py-2"><input type="text" class="form-control" id="guestFirstName"
                            placeholder="First Name" required></div>
                    <div class="invalid-feedback">
                        This field is required
                    </div>
                    <div class="py-2"><input type="text" class="form-control" id="guestLastName" placeholder="Last Name"
                            required></div>
                    <div class="invalid-feedback">
                        This field is required
                    </div>
                    <div class="py-2"><input type="text" class="form-control" id="guestID" placeholder="PIN (7 digits)" minlength="7"
                        maxlength="7" required></div>
                    <div class="invalid-feedback">
                        This field is required
                    </div>
                    <div class="py-2"><input type="email" class="form-control" id="guestEmail" placeholder="Email"
                            required></div>
                    <div class="invalid-feedback">
                        This field is required
                    </div>
                    <div class="form-check py-2">
                        <input class="form-check-input" type="checkbox" value="" id="guestEmailList">
                        <label class="form-check-label" for="guestEmailList">
                            Include guest in email list.
                        </label>
                    </div>
                </div>
            </div>

            <div class="card text-center">
                <div class="card-header">
                    Cruise Preference
                </div>
                <div class="card-body">
                    <h6>Cruise Line</h6>
                    <div class="w-100">
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="cruiseRadio" id="celebrityRadio"
                                value="C" required>
                            <label class="form-check-label" for="celebrityRadio">Celebrity</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="cruiseRadio" id="azamaraRadio"
                                value="A" required>
                            <label class="form-check-label" for="azamaraRadio">Azamara</label>
                        </div>
                        <div class="form-check form-check-inline">
                            <input class="form-check-input" type="radio" name="cruiseRadio" id="royalRadio"
                                value="R" required>
                            <label class="form-check-label" for="royalRadio">Royal</label>
                        </div>
                    </div>

                    <div class="btn-group text-center py-2">
                        <select class="custom-select text-center w-100" id="ShipsDropDown" required>
                            <option value="ship" selected>---Ship---</option>
                            <option class="celebrityShip" value="Eclipse">Eclipse</option>
                            <option class="celebrityShip" value="Edge">Edge</option>
                            <option class="azamaraShip" value="Pursuit">Pursuit</option>
                            <option class="azamaraShip" value="Journey">Journey</option>
                            <option class="royalShip" value="Oasis of the Seas">Oasis of the Seas</option>
                            <option class="royalShip" value="Allure of the Seas">Allure of the Seas</option>
                        </select>
                    </div>

                    <div class="text-center py-2" style="width:fit-content; margin:auto">
                        <h6>Sail Date</h6>
                        <div id="guestSailDate"></div>
                    </div>


                    <div class="py-2">
                        <label for="guestComments">Comments</label>
                        <textarea class="form-control" id="guestComments" rows="5" maxlength="500"></textarea>
                        <p>It cannot be more than 500 characters.</p>
                    </div>


                </div>
            </div>

            <div class="text-center py-2">
                <input type="submit" value="Register" class="btn btn-primary btn-lg"></input>
                <input type="button" value="Reset" class="btn btn-outline-primary btn-lg" onclick="clearFunc()"></input>
            </div class="card text-center">
        </div>
        </div>
    </form>

    <div class="py-2 text-center" style="width: 90%; margin: 0 auto;">
        <hr>
        <h6>Registered Guests</h6>
        <hr>
        <table id="registeredGuestsTable" class="display" style="width:100%">
            <thead>
                <tr>
                    <th>PIN</th>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Email</th>
                    <th>Opted In</th>
                    <th>Brand</th>
                    <th>Ship</th>
                    <th>Sail Date</th>
                    <th>Comments</th>
                    <th></th>
                </tr>
            </thead>
        </table>
    </div>


    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
        integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
        crossorigin="anonymous"></script>
    <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js"></script>
    <script
        src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>

    <script>

        $('#guestSailDate').datepicker({
            startDate: '+1d'
        });

        $(document).ready(function () {
            $('#registeredGuestsTable').DataTable();
        });

        $(document).ready(function () {
            $('#registeredGuestsTable').DataTable({
                "processing": true,
                "serverSide": true,
                "ajax": 'http://localhost/guestList.php'
            });
        });
    </script>

    <script>

        $(document).ready(function () {
            $('.azamaraShip').hide();
            $('.celebrityShip').hide();
            $('.royalShip').hide();
            $('#registeredGuestsTable').DataTable();
        });

        $('#azamaraRadio').click(function () {
            $('.azamaraShip').show();
            $('.celebrityShip').hide();
            $('.royalShip').hide();
        });
        $('#celebrityRadio').click(function () {
            $('.azamaraShip').hide();
            $('.celebrityShip').show();
            $('.royalShip').hide();
        });
        $('#royalRadio').click(function () {
            $('.azamaraShip').hide();
            $('.celebrityShip').hide();
            $('.royalShip').show();
        });

        function registerGuest() {
            var xhttp;
            xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    alert(this.responseText);
                }
            };
            var params = "guestId=" + document.getElementById("guestID").innerHTML +
                "&firstName=" + document.getElementById("guestFirstName").innerHTML +
                "&lastName=" + document.getElementById("guestLastName").innerHTML +
                "&emailAddress=" + document.getElementById("guestEmail").innerHTML +
                "&brand=" + document.querySelector('input[name="cruiseRadio"]:checked').value +
                "&optedIn=" + document.getElementById("guestEmailList").value +
                "&ship=" + document.getElementById("ShipsDropDown").value +
                "&sailDate=" + document.getElementById("guestSailDate").value +
                "&comments=" + document.getElementById("guestComments").innerHTML;

            xhttp.open("POST", "http://localhost/guestRegistration.php?" + params, true);
            xhttp.send();
        }

        function clearFunc() {
            document.getElementById("guestRegistrationForm").reset();
        }

        function deleteGuest(row) {
            var xhttp;
            xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    alert(this.responseText);
                }
            };
            xhttp.open("GET", "http://localhost/guestDeletion.php?guestID=" + row.cells[0].innerHTML, true);
            xhttp.send();
        }
    </script>

    <script>
        // Disable form submission if there are invalid fields
        (function () {
            'use strict';
            window.addEventListener('load', function () {
                var forms = document.getElementsByClassName('needs-validation');
                var validation = Array.prototype.filter.call(forms, function (form) {
                    form.addEventListener('submit', function (event) {
                        if (form.checkValidity() === false) {
                            event.preventDefault();
                            event.stopPropagation();
                        }
                        form.classList.add('was-validated');
                    }, false);
                });
            }, false);
        })();

        function dropdownValidity() {

            var location = document.getElementById('ShipsDropDown');
            var invalid = location.value == "ship";

            if (invalid) {
                location.className = 'error';
            }
            else {
                location.className = '';
            }

            return !invalid;
        }
    </script>

</body>

</html>
